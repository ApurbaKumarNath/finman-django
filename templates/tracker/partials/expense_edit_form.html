<!-- templates/tracker/partials/expense_edit_form.html -->
<tr id="expense-{{ expense.id }}">
    <!-- We've removed the <form> tag from around the cells -->
    
    <!-- Render form fields inside table cells. Make sure they have name attributes. -->
    <td><input type="date" name="date" class="form-control" value="{{ expense.date|date:'Y-m-d' }}"></td>
    <td>
        <select name="category" class="form-select">
            {% for c in categories %}
                <option value="{{ c.id }}" {% if c.id == expense.category.id %}selected{% endif %}>
                    {{ c.name }}
                </option>
            {% endfor %}
        </select>
    </td>
    <td><input type="number" step="0.01" name="amount" class="form-control" value="{{ expense.amount }}"></td>
    <td><input type="text" name="description" class="form-control" value="{{ expense.description|default_if_none:'' }}"></td>

    <td>
        <!-- The HTMX logic is now on the button -->
        <button class="btn btn-sm btn-success" 
                hx-put="{% url 'edit_expense' expense.id %}"
                hx-include="closest tr"
                hx-target="#expense-{{ expense.id }}"
                hx-swap="outerHTML">
            Save
        </button>

        <button type="button" class="btn btn-sm btn-secondary" 
                hx-get="{% url 'get_expense_row' expense.id %}" 
                hx-target="#expense-{{ expense.id }}" 
                hx-swap="outerHTML">
            Cancel
        </button>
    </td>
</tr>